const mongoose = require("mongoose"); const User = require("../models/User"); async function connectDB() { try { await mongoose.connect(process.env.MONGO_URI || "mongodb://admin:123123@192.168.0.202:27017/emr?authSource=admin"); console.log("✅ 数据库连接成功"); } catch (error) { console.error("❌ 数据库连接失败:", error.message); process.exit(1); } } async function createTestUsers() { try { console.log("
📝 创建测试用户..."); const existingUsers = await User.find(); console.log(`当前数据库中有 ${existingUsers.length} 个用户`); if (existingUsers.length === 0) { const testUsers = [{ name: "张三", email: "zhangsan@test.com", password: "password123", role: "patient", phone: "13800138001", isActive: true }, { name: "李医生", email: "doctor.li@test.com", password: "password123", role: "doctor", phone: "13800138002", specialization: "内科", department: "内科", isActive: true }, { name: "王护士", email: "nurse.wang@test.com", password: "password123", role: "doctor", phone: "13800138003", specialization: "护理", department: "护理部", isActive: true }]; for (const userData of testUsers) { const user = new User(userData); await user.save(); console.log(`✅ 创建用户: ${userData.name} (${userData.email})`); } } else { console.log("用户已存在，跳过创建"); } const allUsers = await User.find().select("-password"); console.log("
📋 所有用户列表:"); allUsers.forEach(user => { console.log(`- ${user.name} (${user.email}) - ${user.role} - ${user.isActive ? "启用" : "禁用"}`); }); } catch (error) { console.error("❌ 创建用户失败:", error.message); } } async function main() { await connectDB(); await createTestUsers(); await mongoose.disconnect(); console.log("
🎉 测试完成"); } main();
